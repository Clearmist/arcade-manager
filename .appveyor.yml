platform:
- x64

environment:
  nodejs_version: "9"

cache:
- 'node_modules'
- '%USERPROFILE%\.electron'

# Install scripts. (runs after repo cloning)
install:
  # install node
  - ps: Install-Product node $env:nodejs_version
  # build number
  - ps: $env:package_version = (Get-Content -Raw -Path package.json | ConvertFrom-Json).version
  - ps: Update-AppveyorBuild -Version "$($env:package_version)-$env:APPVEYOR_BUILD_NUMBER"
  # install node modules
  - npm install
  - npm prune
  # build electron package
  - npm run dist -- --win --linux --x64

test_script:
  - node --version
  - npm --version

# artifacts:
#   - path: dist\RetropieArcadeManager Setup*.exe
#     name: Retropie Arcade Manager Windows (Setup)
#   - path: dist\RetropieArcadeManager-*-win.zip
#     name: Retropie Arcade Manager Windows (Standalone)
#   - path: dist\retropie-arcade-manager*.snap
#     name: Retropie Arcade Manager Linux (Snap)
#   - path: dist\retropie-arcade-manager*.AppImage
#     name: Retropie Arcade Manager Linux (AppImage)

# Don't actually build.
build: off

# deploy:
# - provider: BinTray
#   username: cosmo0
#   api_key:
#     secure: NWundKYe7riNRrADb64QuUkdctcNJIFT3iVjTu1Yuh/pdPpmaIi8BO35II0ECo00
#   subject: cosmo0
#   repo: retropie-arcade-manager
#   package: retropie-arcade-manager
#   publish: true
#   override: true
#   explode: false