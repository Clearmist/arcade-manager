<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="pages/index.html" class="navmenu">Home</a></li>
        <li class="breadcrumb-item active" aria-current="page">Install overlays</li>
    </ol>
</nav>

<h2>
    Download and install an overlays pack
    <a href="pages/help/shares.html" class="navmenu">How to access my Retropie/Recabox shares</a>
</h2>

<p>
    Select the overlays pack you want, and the path to you roms folder. This will
    download and install only the files you need for the games you have.<br>
    Note that it will only work with Libretro emulators (lr-mame and lr-fba), not AdvanceMAME or MAME4All.
</p>

<div class="row mb-4" id="packs"></div>

<!-- path to roms -->
<div class="input-group mb-0">
    <div class="input-group-prepend">
        <span class="input-group-text">Roms folder</span>
    </div>
    <input type="text" class="form-control" id="romsFolder">
    <div class="input-group-append">
        <button class="btn btn-outline-secondary browse folder" type="button" data-input="romsFolder">Browse</button>
    </div>
</div>
<p class="mt-0 mb-3">
    <small class="form-text text-muted">The folder containing the roms (ex: \\retropie\roms\arcade or \\recalbox\shares\roms\arcade)</small>
</p>

<!-- path to config -->
<div class="input-group mb-0">
    <div class="input-group-prepend">
        <span class="input-group-text">Config</span>
    </div>
    <input type="text" class="form-control" id="configFolder">
    <div class="input-group-append">
        <button class="btn btn-outline-secondary browse folder" type="button" data-input="configFolder">Browse</button>
    </div>
</div>
<p class="mt-0 mb-3">
    <small class="form-text text-muted">The path to the configs share (ex: \\retropie\configs or \\recalbox\shares)</small>
</p>

<div class="form-check form-check-inline">
    <input class="form-check-input" type="radio" name="overwrite" id="overwriteYes" value="yes">
    <label class="form-check-label" for="overwriteYes">Overwrite existing files</label>
</div>
<div class="form-check form-check-inline">
    <input class="form-check-input" type="radio" name="overwrite" id="overwriteNo" value="no" checked>
    <label class="form-check-label" for="overwriteNo">Do not overwrite existing files</label>
</div>

<p class="mt-3">
    <button type="button" id="buttonInstall" class="btn btn-primary btn-lg btn-block">Download and install</button>
</p>

<script>
$(() => {
    let data = JSON.parse(fs.readFileSync(path.join(__dirname, 'data.json'), { encoding: 'utf8' }));
    let template = $('#csvItemTemplate').html();

    let colsize = 12 / data.overlays.length;
    if (colsize < 3) { colsize = 3; }

    // fill paths with defaults
    if (settings.has('os')) {
        $('#romsFolder').val(data.defaults.roms[settings.get('os')][process.platform]);
        $('#configFolder').val(data.defaults.configs[settings.get('os')][process.platform]);
    }

    // list overlays packs
    for (let ovl of data.overlays) {
        let li = $(template);

        // layout
        li.addClass('col-' + colsize);

        // build pack infos
        li.find('.name').text(ovl.name);
        li.find('.desc').text(ovl.description);
        if (ovl.image !== '') {
            li.find('img').attr('src', ovl.image);
        } else {
            li.find('img').remove();
        }

        // pack meta-data
        li.data('pack', ovl);

        li.on('click', () => {
            $('#packs').find('.active').removeClass('active');
            $('#packs').find(':radio').prop('checked', false);
            li.addClass('active').find(':radio').prop('checked', true);
        });

        $('#packs').append(li);
    }

    // Handle click on validation button
    $('#buttonInstall').on('click', (e) => {
        let romsFolder = $('#romsFolder').val(),
            configFolder = $('#configFolder').val(),
            pack = $('#packs .active'),
            overwrite = $('input[name=overwrite]:checked').val() == 'yes' ? true : false;
        
        // get pack data
        let packInfos = pack.data('pack');

        // check inputs and paths
        if (pack.length === 0) { window.alert('Please select an overlay pack'); return; }
        if (romsFolder === '') { window.alert('Please fill the path to the roms folder'); return; }

        // download and install pack
        overlays.downloadPack(romsFolder, configFolder, packInfos, overwrite);
    });
});
</script>

<script type="text/template" id="csvItemTemplate">
    <div>
        <a href="#" class="border rounded d-block p-3 text-dark">
            <input type="radio" class="float-left mr-3 mt-4">
            <img src="" class="float-left mr-3">
            <h5 class="mb-1 name"></h5>
            <p class="mb-0 desc"></p>
        </a>
    </div>
</script>
