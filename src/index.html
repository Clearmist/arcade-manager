<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="css/bootstrap.css">

    <title>Retropie arcade romset manager</title>
  </head>
  <body>

    <div class="container">
        <h1>Retropie romset arcade manager</h1>
        
        <div class="alert alert-danger" role="alert">
            This tool <strong>does not</strong> rebuild a romset or change its version.
        </div>
        
        <p>It is intended to quickly filter a romset in an already "good" version.</p>

        <p>Select a file, an action, and a target.</p>

        <form>

            <!-- Main CSV file -->
            <div class="input-group mb-0">
                <div class="input-group-prepend">
                    <span class="input-group-text">Main CSV file</span>
                </div>
                <div class="custom-file">
                    <input type="file" class="custom-file-input" id="fileMainCsv">
                    <label class="custom-file-label" for="fileMainCsv"></label>
                </div>
            </div>
            <p class="mt-0 mb-3">
                <small class="form-text text-muted">Select the file to execute an action with</small>
            </p>
            
            <!-- Action -->
            <div class="border rounded mb-3 p-2">
                <p class="mb-0">
                    Action using the main CSV file
                </p>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="action" value="fileadd" id="fileadd" data-display=".romset">
                    <label class="form-check-label" for="fileadd">Add roms listed in the file</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="action" value="fileremove" id="fileremove" data-display=".romselection">
                    <label class="form-check-label" for="fileremove">Remove rows listed in the file</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="action" value="csvadd" id="csvadd" data-display=".merge">
                    <label class="form-check-label" for="csvadd">Add rows from another file</label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="action" value="csvremove" id="csvremove" data-display=".merge">
                    <label class="form-check-label" for="csvremove">Remove rows from another file</label>
                </div>
            </div>

            <!-- Merge: secondary CSV file -->
            <div class="input-group mb-0 optional d-none merge">
                <div class="input-group-prepend">
                    <span class="input-group-text">Secondary CSV file</span>
                </div>
                <div class="custom-file">
                    <input type="file" class="custom-file-input" id="fileSecondaryCsv">
                    <label class="custom-file-label" for="fileSecondaryCsv"></label>
                </div>
            </div>
            <p class="mt-0 mb-3 optional d-none merge">
                <small class="form-text text-muted">This file will modify the first one using the selected action.</small>
            </p>

            <!-- Merge: target output file -->
            <div class="input-group mb-0 optional d-none merge">
                <div class="input-group-prepend">
                    <span class="input-group-text">Target file</span>
                </div>
                <div class="custom-file">
                    <input type="file" class="custom-file-input" id="fileTarget">
                    <label class="custom-file-label" for="fileTarget"></label>
                </div>
            </div>
            <p class="mt-0 mb-3 optional d-none merge">
                <small class="form-text text-muted">The merged file to be saved</small>
            </p>
    
            <!-- Full romset location -->
            <div class="input-group mb-0 optional d-none romset">
                <div class="input-group-prepend">
                    <span class="input-group-text">Full romset</span>
                </div>
                <div class="custom-file">
                    <input type="file" class="custom-file-input" id="fileRomset" webkitdirectory>
                    <label class="custom-file-label" for="fileRomset"></label>
                </div>
            </div>
            <p class="mt-0 mb-3 optional d-none romset">
                <small class="form-text text-muted">The folder containing all the files of the romset</small>
            </p>
            
            <!-- Selection romset location -->
            <div class="input-group mb-0 optional d-none romselection">
                <div class="input-group-prepend">
                    <span class="input-group-text">Rom selection</span>
                </div>
                <div class="custom-file">
                    <input type="file" class="custom-file-input" id="fileRomSelection" webkitdirectory>
                    <label class="custom-file-label" for="fileRomSelection"></label>
                </div>
            </div>
            <p class="mt-0 mb-3 optional d-none romselection">
                <small class="form-text text-muted">The folder containing the subset of the roms you want</small>
            </p>
            
            <p class="mt-3">
                <button type="button" id="buttonOk" class="btn btn-primary btn-lg btn-block">Run</button>
            </p>

        </form>

    </div>

    <!-- Fixes jQuery integration https://stackoverflow.com/a/37480521/6776 -->
    <script>if (typeof module === 'object') {window.module = module; module = undefined;}</script>
    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/popper.js"></script>
    <script type="text/javascript" src="js/bootstrap.js"></script>
    <script>if (window.module) module = window.module;</script>

    <script type="text/javascript">
        const {dialog} = require('electron').remote;

        // hide or display the optional fields
        $('input[name=action]').change((e) => {
            $('.optional').addClass('d-none');
            $($(e.target).data('display')).removeClass('d-none');
        });

        // target file is new so default file browse cannot be used
        $('#fileTarget').on('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            dialog.showSaveDialog((filename) => {
                console.log('success');
            });
        });
    </script>
</body>
</html>